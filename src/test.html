<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .table {
        border: 1px solid rgba(245, 245, 245, 0.5);
        border-radius: 20px;
        border-collapse: collapse;
        width: 100%;
      }
      .table th,
      .table td {
        padding: 4px;
        border: 1px solid rgba(12, 10, 10, 0.84);
      }

      .table tbody tr:nth-child(2n) {
        background-color: rgba(240, 248, 255, 0.2);
      }

      .table tbody td:first-child {
        width: 2rem;
      }

      .select {
        padding: 4px;
        font-size: medium;
      }

      button {
        padding: 4px 8px;
        margin: 4px;
        border: solid rgba(128, 128, 128, 0.5) 1px;
        border-radius: 2px;
      }

      iframe {
        width: 100%;
        height: 50rem;
      }
    </style>
  </head>
  <body
    onload='fetch("http://mizhibd.com/checkApp/backend/queryOneSite.php", {
    method: "POST",
    body: new FormData(document.querySelector("#statusForm")),
  })
    .then((res) => res.json())
    .then((res) => {
      document.querySelector("#statusDisplay").innerHTML =
        res.affected_rows[0].status;
    });'
  >
    <table class="table">
      <tbody>
        <tr>
          <td>Lon：</td>
          <td>${locateData.lon}</td>
        </tr>
        <tr>
          <td>Lat：</td>
          <td>${locateData.lat}</td>
        </tr>
        <tr>
          <td>Type：</td>
          <td>${locateData.type}</td>
        </tr>
        <tr>
          <td>Rural_area：</td>
          <td>${locateData.Rural_Area}</td>
        </tr>
        <tr>
          <td>Rural_population：</td>
          <td>${locateData.Rural_Population}</td>
        </tr>
        <tr>
          <td>Name：</td>
          <td>${locateData.name}</td>
        </tr>
        <tr>
          <td>StreetCode：</td>
          <td>${locateData.strt}</td>
        </tr>
        <tr>
          <td>Code：</td>
          <td>${locateData.code}</td>
        </tr>
        <tr>
          <td>Checked：</td>
          <td>${locateData.checked}</td>
        </tr>
        <tr>
          <td>Status：</td>
          <td>
            <span id="statusDisplay">${locateData.status}</span>
            <button
              id="showSelect"
              onclick="document.querySelector('#changeTR').hidden = false"
            >
              点击修改
            </button>
          </td>
        </tr>
        <tr id="changeTR" hidden onload="">
          <td>Status 修改为</td>
          <td>
            <form id="statusForm">
              <input name="code" value="110101017001" hidden />
              <input name="provinceCode" value="11_beijing" hidden />
              <select
                name="status"
                class="select"
                value="${
                locateData.status
              }"
              >
                <option value="0" title="0：正常">&nbsp;0：正常</option>
                <option value="1" title="1：整体搬迁，图斑、人口设定为 0">
                  &nbsp;1：整体搬迁，图斑、人口设定为 0
                </option>
                <option value="-1" title="-1：部分搬迁，图斑、人口不为0">
                  -1：部分搬迁，图斑、人口不为0
                </option>
                <option
                  value="2"
                  title="2：特殊点位，（如军队、监狱、拘留所、劳改农场等），图斑、人口设定为
                0"
                >
                  &nbsp;2：特殊点位，图斑、人口设定为 0
                </option>
                <option
                  value="-2"
                  title="-2：特殊点位，（如军队、监狱、拘留所、劳改农场等），图斑、人口不为0特殊点位"
                >
                  -2：特殊点位，图斑、人口不为0特殊点位
                </option>
              </select>

              <!-- <input type="radio" name="status" id="" value="0" /><label for=""
                >0：正常点位</label
              >
              <br />
              <input type="radio" name="status" id="" value="1" /><label for=""
                >1：整体搬迁</label
              >
              <input type="radio" name="status" id="" value="-1" /><label for=""
                >-1：部分搬迁</label
              >
              <br />
              <input type="radio" name="status" id="" value="2" /><label for=""
                >2：特殊点位</label
              >
              <input type="radio" name="status" id="" value="-2" /><label for=""
                >-2：特殊点位</label
              > -->

              <button
                type="button"
                onclick='const data = new FormData(document.querySelector("#statusForm"));
              fetch("http://mizhibd.com/checkApp/backend/updateStatus.php", {
                method: "POST",
                body: data,
              }).then(() => {
                document.querySelector("#changeTR").hidden = true;
                document.querySelector("#statusDisplay").innerHTML = data.get("status");
              });'
              >
                确认
              </button>
            </form>
          </td>
        </tr>
      </tbody>
    </table>
  </body>
  <script>
    const change = function () {
      const changeTR = document.querySelector("#changeTR");
      changeTR.hidden = false;
    };

    const updatePointStatus = function () {
      const data = new FormData(document.querySelector("#statusForm"));
      fetch("http://mizhibd.com/checkApp/backend/updateStatus.php", {
        method: "POST",
        body: data,
      }).then(() => {
        document.querySelector("#changeTR").hidden = true;
        document.querySelector("#statusDisplay").innerHTML = data.get("status");
      });
    };

    const getStatusInfo = function () {
      fetch("http://mizhibd.com/checkApp/backend/queryOneSite.php", {
        method: "POST",
        body: new FormData(document.querySelector("#statusForm")),
      })
        .then((res) => res.json())
        .then((res) => {
          document.querySelector("#statusDisplay").innerHTML =
            res.affected_rows[0].status;
        });
    };
  </script>
</html>
